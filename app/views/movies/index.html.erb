<head>
  <%stylesheet_link_tag 'movies' %>
</head>
<div class="container">
  <div class="row">
    <div class="col-md-6 offset-md-3">
      <form action="<%= movies_path %>" method="get" class="form-inline">
        <div class="form-group mb-2">
          <label for="start_date" class="sr-only">Start Date</label>
          <%= date_field_tag :start_date, params[:start_date], class: "form-control" %>
        </div>
        <div class="form-group mx-sm-3 mb-2">
          <label for="end_date" class="sr-only">End Date</label>
          <%= date_field_tag :end_date, params[:end_date], class: "form-control" %>
        </div>
        <button type="submit" class="btn btn-primary mb-2">Filter</button>
      </form>
    </div>
  </div>
</div>
<div class="row">
  <%@movies.each do |movie| %>
    <div class="col-md-2">
      <div class="img-thumbnail text-center">
        <%if movie.image.attached? %>
          <%= link_to image_tag(movie.image, class: "image"), movie%>
        <%else %>
            <p>Preview not available</p>
        <%end %>
      </div>
      <% if movie.average_rating.present? %>
        <% filled_stars = movie.average_rating.round %>
        <div class="star-count">
          <% 5.times do |i| %>
            <% if i < filled_stars %>
              <span class="star filled">&#9733;</span>
            <% else %>
              <span class="star">&#9733;</span>
            <% end %>
          <%end %>
          (<%= '%.1f' % movie.average_rating %>)
        </div>
      <% else %>
        <p>No ratings yet</p>
      <% end %>
      <p>ratings count: <%=movie.ratings_count %></p>
    </div>
  <% end %>
  <div class="pagination">
    <%= paginate @movies %>
  </div>
</div>